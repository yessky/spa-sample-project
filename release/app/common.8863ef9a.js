define("base/has",["require","exports","module"],function(require,exports,module){var n=this,o=document,t="undefined",e=typeof window!==t&&typeof location!==t&&typeof document!==t&&window.location===location&&window.document===document,d=o.createElement("DiV"),i={},r=function(t){return"function"==typeof i[t]?i[t]=i[t](n,o,d):i[t]};r.add=function(n,o,t,e){return(void 0===i[n]||e)&&(i[n]=o),t&&r(n)},r.add("bug-for-in-skips-shadowed",function(){for(var n in{toString:1})return 0;return 1}),r.add("host-browser",e),r.add("dom",e),r("host-browser")&&(r.add("dom-addeventlistener",!!document.addEventListener),r.add("pointer-events","onpointerdown"in document),r.add("MSPointer","msMaxTouchPoints"in navigator),r.add("touch","ontouchstart"in document||"onpointerdown"in document&&navigator.maxTouchPoints>0||window.navigator.msMaxTouchPoints),r.add("touch-events","ontouchstart"in document),r.add("device-width",screen.availWidth||innerWidth)),module.exports=r});
define("base/lang",["require","exports","module","underscore","./has"],function(require,exports,module){"use strict";function r(r){return null==r?String(r):(i.call(r).match(/\[\w+\s*(\w+)\]/)[1]||"object").toLowerCase()}function n(r,n,t){var e={};for(var o in n){var i=n[o];o in r&&(r[o]===i||o in e&&e[o]===i)||(r[o]=t?t(o,i):i)}return r}function t(r){if(!r||"object"!=typeof r||_.isFunction(r))return r;if(r.nodeType&&"cloneNode"in r)return r.cloneNode(!0);if(r instanceof Date)return new Date(r.getTime());if(r instanceof RegExp)return new RegExp(r);var e=[];if(_.isArray(r))for(var o=0,i=r.length;i>o;++o)o in r&&e.push(t(r[o]));else e=r.constructor?new r.constructor:{};return n(e,r,t)}function e(r,n){return n.toUpperCase()}var _=require("underscore"),o=(require("./has"),Object.prototype),i=o.toString,c=o.hasOwnProperty,u=Array.prototype.slice,a=String.prototype.trim,l=/^[\x20\t\n\r\f]+/,f=/[\x20\t\n\r\f]+$/,p=/^-ms-/,s=/-([\da-z])/gi,y=function(){function r(){}return function(t,e){r.prototype=t;var o=new r;return r.prototype=null,e&&n(o,e),o}}(),d=y(_,{});return _.extend(d,{noop:function(){},type:r,isArrayLike:function(n){var t=n.length,e=r(n);return 1===n.nodeType&&"number"==typeof t&&"form"===n.nodeName.toLowerCase()?!0:"array"===e||"function"!==e&&(0===t||"number"==typeof t&&t>0&&t-1 in n)},isEmptyObject:function(r){for(var n in r)return!1;return!0},isPlainObject:function(n){if(!n||"object"!==r(n)||n.nodeType||n.window===n)return!1;try{if(n.constructor&&!c.call(n,"constructor")&&!c.call(n.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}for(var e in n);return void 0===e||c.call(n,e)},trim:function(r){return r&&_.isString(r)?a?r.trim():r.replace(l,"").replace(f,""):r},clone:t,camelize:function(r){return r.replace(p,"ms-").replace(s,e)},mix:function(r,t){r||(r={});for(var e=1,o=arguments.length;o>e;e++)n(r,arguments[e]);return r},delegate:y,hitch:function(r,n){var t=u.call(arguments,2);return n||(n=r,r=null),_.isString(n)?(r=r||window,function(){var e=r[n];if(!e)throw['lang.hitch: scope["',n,'"] is null (scope="',r,'")'].join("");var o=t.concat(u.call(arguments));return e.apply(r,o)}):r?function(){var e=t.concat(u.call(arguments));return n.apply(r,e)}:n},delay:function(r,n){var t=_.delay(r,n);return{remove:function(){clearTimeout(t)}}}}),d});
define("base/declare",["require","exports","module","./lang"],function(require,exports,module){function t(t,e){throw new Error("declare"+(e?" "+e:"")+": "+t)}function e(e,n){for(var r,o,s,a,i,c,u,l,p=[],f=[{cls:0,refs:[]}],d={},y=1,m=e.length,g=0;m>g;++g){for(s=e[g],s?"function"!==h(s)&&t("mixin #"+g+" is not a callable constructor.",n):t("mixin #"+g+' is unknown. Did you use "require" to pull it in?',n),o=s._meta?s._meta.bases:[s],a=0,r=o.length-1;r>=0;--r)i=o[r].prototype,i.hasOwnProperty("declaredClass")||(i.declaredClass="uniqName_"+b++),u=i.declaredClass,d.hasOwnProperty(u)||(d[u]={count:0,refs:[],cls:o[r]},++y),c=d[u],a&&a!==c&&(c.refs.push(a),++a.count),a=c;++a.count,f[0].refs.push(a)}for(;f.length;){for(a=f.pop(),p.push(a.cls),--y;l=a.refs,1===l.length;){if(a=l[0],!a||--a.count){a=0;break}p.push(a.cls),--y}if(a)for(g=0,m=l.length;m>g;++g)a=l[g],--a.count||f.push(a)}return y&&t("can't build consistent linearization",n),s=e[0],p[0]=s?s._meta&&s===p[p.length-s._meta.bases.length]?s._meta.bases.length:1:0,p}function n(e,n,r){var o,s,a,i,c,u,l,p,f=this.__inherited__=this.__inherited__||{};if("string"==typeof e&&(o=e,e=n,n=r),r=0,a=e.callee,o=o||a.nom,o||t("can't deduce a name to call inherited()",this.declaredClass),i=this.constructor._meta,s=i.bases,p=f.p,o!==g){if(f.c!==a&&(p=0,c=s[0],i=c._meta,i.hidden[o]!==a)){do if(i=c._meta,u=c.prototype,i&&(u[o]===a&&u.hasOwnProperty(o)||i.hidden[o]===a))break;while(c=s[++p]);p=c?p:-1}if(c=s[++p])if(u=c.prototype,c._meta&&u.hasOwnProperty(o))r=u[o];else{l=y[o];do if(u=c.prototype,r=u[o],r&&(c._meta?u.hasOwnProperty(o):r!==l))break;while(c=s[++p])}r=c&&r||y[o]}else{if(f.c!==a&&(p=0,i=s[0]._meta,i&&i.ctor!==a)){for(;(c=s[++p])&&(i=c._meta,!i||i.ctor!==a););p=c?p:-1}for(;(c=s[++p])&&(i=c._meta,!(r=i?i.ctor:c)););r=c&&r}return f.c=r,f.p=p,r?n===!0?r:r.apply(this,n||e):void 0}function r(t){for(var e=this.constructor._meta.bases,n=0,r=e.length;r>n;++n)if(e[n]===t)return!0;return this instanceof t}function o(t,e){for(var n in e)n!==g&&e.hasOwnProperty(n)&&(t[n]=e[n])}function s(t,e){return"function"===h(e)&&(e.nom=t),e}function a(t,e){var n,r;for(n in e)r=e[n],r===y[n]&&n in y||n===g||("function"===h(r)&&(r.nom=n),t[n]=r);return t}function i(t){return function(){var e,n,r,o=arguments,s=o,a=(o[0],t.length);if(!(this instanceof o.callee))return l(o);for(n=a-1;n>=0;--n)e=t[n],r=e._meta,e=r?r.ctor:e,e&&e.apply(this,o);e=this.postscript,e&&e.apply(this,s)}}function c(t){return function(){var e,n=arguments;n[0];return this instanceof n.callee?(t&&t.apply(this,n),e=this.postscript,void(e&&e.apply(this,n))):l(n)}}function u(t){m.prototype=t.prototype;var e=new m;return m.prototype=null,e}function l(t){var e=t.callee,n=u(e);return e.apply(n,t),n}function p(l,p,f){"string"!=typeof l?(f=p,p=l,l=""):l=l.replace(/\//g,"."),f=f||{};var m,b,w,v,O,P=1,k=p;if("array"===h(p)?(O=e(p,l),w=O[0],P=O.length-w,p=O[P]):(O=[0],p?"function"===h(p)?(w=p._meta,O=O.concat(w?w.bases:p)):t("base class is not a callable constructor.",l):null!==p&&t("unknown base class. Did you use dojo.require to pull it in?",l)),p)for(b=P-1;m=u(p),b;--b)w=O[b],(w._meta?o:d)(m,w.prototype,s),v=new Function,v.superclass=p,v.prototype=m,p=m.constructor=v;else m={};return a(m,f),w=f.constructor,w!==y.constructor&&(w.nom=g,m.constructor=w),O[0]=v=1===O.length?c(f.constructor):i(O),v._meta={bases:O,hidden:f,parents:k,ctor:f.constructor},v.superclass=p&&p.prototype,v.prototype=m,m.constructor=v,m.isInstanceOf=r,m.inherited=n,l&&(m.declaredClass=l),v}var f=require("./lang"),h=f.type,d=f.mix,y=Object.prototype,m=new Function,b=0,g="constructor";module.exports=p});
define("base/dom",["require","exports","module","jquery"],function(require,exports,module){function e(e){return o?o+e:e.toLowerCase()}var $=require("jquery"),n=function(e){return function(){var n,t=arguments[0],r=Array.prototype.slice.call(arguments,1);if(t){var a=$(t);n=a[e].apply(a,r)}return n}},t=function(e){return function(n,t){var r=$(n);return r.on(e,t),{remove:function(){r.off(e,t)}}}},r=$.fx&&$.fx.cssPrefix,a=$.fx&&$.fx.transitionEnd,i=$.fx&&$.fx.animationEnd;if(!$.fx||!$.fx.hasOwnProperty("cssPrefix")){var o,c=document.createElement("div"),s={Webkit:"webkit",Moz:"",O:"o"};$.each(s,function(e,n){return void 0!==c.style[e+"TransitionProperty"]?(prefix="-"+e.toLowerCase()+"-",o=n,!1):void 0}),r=prefix,a=e("TransitionEnd"),i=e("AnimationEnd")}var f={cssPrefix:r,transitionEnd:a,animationEnd:i,jqWrap:n,byId:function(e,n){return e.nodeType?e:(n||document).getElementById(e)},query:function(e,n){return $(e,n)},place:function(e,n,t){switch(t){case"before":f.before(n,e);break;case"after":f.after(n,e);break;case"only":f.empty(n),f.append(n,e);break;case"first":n.firstChild?f.before(n.firstChild,e):f.append(n,e);break;default:f.append(n,e)}},create:function(e,n,t,r){var a=document.createElement(e);return n&&f.attr(a,n),t&&f.place(a,t,r),a},formToObject:function(e,n){e=$(e);var t={};return void 0===n&&(n=!0),$.each(e.serializeArray(),function(e,r){return t[r.name]=n?$.trim(r.value):r.value}),t},matchesSelector:$.zepto?$.zepto.matches:$.find.matchesSelector,contains:$.contains,parse:function(e){var n=$(e),t=document.createDocumentFragment();return n.each(function(e,n){return t.appendChild(n)}),t},matrix:function(e){var n=window.getComputedStyle(e,null);return n=n[r+"transform"].split(")")[0].split(", "),{x:+(n[12]||n[4]||0),y:+(n[13]||n[5]||0)}},isDescendant:function(e,n){try{for(;e;){if(e===n)return!0;e=e.parentNode}}catch(t){}return!1}};return $.each(["hasClass","addClass","removeClass","css","attr","removeAttr","remove","empty","parent","parents","children","siblings","next","prev","prepend","append","prependTo","appendTo","before","after","html","val","serializeArray","show","hide","animate","width","height","position","offset","scrollTop","scrollLeft"],function(e,t){f[t]=n(t)}),$.fn.swipeDown&&(f.gesture={},$.each(["tap","doubleTap","longTap","swipe","swipeLeft","swipeUp","swipeRight","swipeDown","pinch","pinchIn","pinchOut"],function(e,n){f.gesture[n]=t(n)})),f});
define("base/aspect",["require","exports","module"],function(require,exports,module){"use strict";function e(e,r,i,t){var a,u=e[r],o="around"===r;if(o){var v=i(function(){return u&&u.advice(this,arguments)});a={remove:function(){v&&(v=e=i=null)},advice:function(e,r){return v?v.apply(e,r):u.advice(e,r)}}}else a={remove:function(){if(a.advice){var n=a.previous,t=a.next;t||n?(n?n.next=t:e[r]=t,t&&(t.previous=n)):delete e[r],e=i=a.advice=null}},id:n++,advice:i,receiveArgs:t};if(u&&!o)if("after"===r){for(;u.next&&(u=u.next););u.next=a,a.previous=u}else"before"===r&&(e[r]=a,a.next=u,u.previous=a);else e[r]=a;return a}function r(r){return function(t,a,u,o){var v,c=t[a];c&&c.__dispatchid||(t[a]=v=function(){for(var e=n,r=arguments,t=v.before;t;)r=t.advice.apply(this,r)||r,t=t.next;if(v.around)var a=v.around.advice(this,arguments);for(var u=v.after;u&&u.id<e;){if(u.receiveArgs){var o=u.advice.apply(this,r);a=o===i?a:o}else a=u.advice.call(this,a,r);u=u.next}return a},c&&(v.around={advice:function(e,r){return c.apply(e,r)}}),v.__dispatchid=n);var f=e(v||c,r,u,o);return u=null,f}}var i,n=1;return{before:r("before"),after:r("after"),around:r("around")}});
define("base/Evented",["require","exports","module","./lang","./declare"],function(require,exports,module){var e=require("./lang"),n=require("./declare");return n("Evented",null,{emit:function(n){var t=this.__events__&&this.__events__[n],r=[].slice.call(arguments,1);t&&e.forEach(t.slice(0),function(e,n){e.apply(null,r)})},on:function(e,n){var t=this.__events__||(this.__events__={}),r=t[e]||(t[e]=[]);return r.push(n),{remove:function(){for(var e=0;e<r.length;e++)if(r[e]===n)return r.splice(e,1)}}}})});
define("base/sniff",["require","exports","module","./has"],function(require,exports,module){var e=require("./has"),d=window.navigator,a=d.userAgent,i=d.appVersion,o=window.parseFloat(i);if(e.add("khtml",i.indexOf("Konqueror")>=0?o:void 0),e.add("webkit",parseFloat(a.split("WebKit/")[1])||void 0),e.add("chrome",parseFloat(a.split("Chrome/")[1])||void 0),e.add("safari",i.indexOf("Safari")>=0&&!e("chrome")?parseFloat(i.split("Version/")[1]):void 0),e.add("mac",i.indexOf("Macintosh")>=0),a.match(/(iPhone|iPod|iPad)/)){var r=RegExp.$1.replace(/P/,"p"),t=a.match(/OS ([\d_]+)/)?RegExp.$1:"1",s=parseFloat(t.replace(/_/,".").replace(/_/g,""));e.add(r,s),e.add("ios",s)}if(e.add("android",parseFloat(a.split("Android ")[1])||void 0),e.add("wechat",/MicroMessenger/i.test(a)),e.add("mobile",e("android")||e("ios")),e.add("trident",parseFloat(i.split("Trident/")[1])||void 0),e.add("svg","undefined"!=typeof SVGAngle),!e("webkit")&&(a.indexOf("Opera")>=0&&e.add("opera",o>=9.8?parseFloat(a.split("Version/")[1])||o:o),a.indexOf("Gecko")>=0&&!e("khtml")&&!e("webkit")&&!e("trident")&&e.add("mozilla",o),e("mozilla")&&e.add("ff",parseFloat(a.split("Firefox/")[1]||a.split("Minefield/")[1])||void 0),document.all&&!e("opera"))){var l=parseFloat(i.split("MSIE ")[1])||void 0,n=document.documentMode;n&&5!=n&&Math.floor(l)!=n&&(l=n),e.add("ie",l)}return e});
define("base/on",["require","./has","./aspect","./dom"],function(require){"use strict";function e(){this.cancelable=!1,this.defaultPrevented=!0}function t(){this.bubbles=!1}function n(e,t,n,i){var o=t.match(/(.*)@(.*)/);if(o)return t=o[1],o=o[2],p.selector(o,t).call(i,e,n);if(r("touch")&&(s.test(t)&&(n=C(n)),r("event-orientationchange")||"orientationchange"!==t||(t="resize",e=window,n=C(n))),d&&(n=d(n)),e.addEventListener){var a=t in l,c=a?l[t]:t;return e.addEventListener(c,n,a),{remove:function(){e.removeEventListener(c,n,a)}}}if(t="on"+t,b&&e.attachEvent)return b(e,t,n);throw new Error("Target must be an event emitter")}var r=require("./has"),i=require("./aspect"),o=require("./dom");if(r("dom")){var a=window.ScriptEngineMajorVersion,c=window.Event;r.add("jscript",a&&a()+ScriptEngineMinorVersion()/10),r.add("event-orientationchange",r("touch")&&!r("android")),r.add("event-stopimmediatepropagation",c&&!!c.prototype&&!!c.prototype.stopImmediatePropagation),r.add("event-focusin",function(e,t,n){return"onfocusin"in n}),r("touch")&&r.add("touch-can-modify-event-delegate",function(){var e=function(){};e.prototype=document.createEvent("MouseEvents");try{var t=new e;return t.target=null,null===t.target}catch(n){return!1}})}var u=/[\x20\t\n\r\f]*,[\x20\t\n\r\f]*/,s=/^touch/,l=r("event-focusin")?{}:{focusin:"focus",focusout:"blur"};if(!r("event-stopimmediatepropagation"))var f=function(){this.immediatelyStopped=!0,this.modified=!0},d=function(e){return function(t){return t.immediatelyStopped?void 0:(t.stopImmediatePropagation=f,e.apply(this,arguments))}};var p=function(e,t,r){return"function"!=typeof e.on||"function"==typeof t||e.nodeType?p.parse(e,t,r,n,this):e.on(t,r)},v=[].slice,h=p.emit=function(n,r,i){var o=v.call(arguments,2),a="on"+r;if("parentNode"in n){var c=o[0]={};for(var u in i)c[u]=i[u];c.preventDefault=e,c.stopPropagation=t,c.target=n,c.type=r,i=c}do n[a]&&n[a].apply(n,o);while(i&&i.bubbles&&(n=n.parentNode));return i&&i.cancelable&&i};if(r("dom-addeventlistener"))p.emit=function(e,t,n){if(e.dispatchEvent&&document.createEvent){var r=e.ownerDocument.createEvent("HTMLEvents");r.initEvent(t,!!n.bubbles,!!n.cancelable);for(var i in n)i in r||(r[i]=n[i]);return e.dispatchEvent(r)&&r}return h.apply(p,arguments)};else{p._fixEvent=function(e,t){if(!e){var n=t&&(t.ownerDocument||t.document||t).parentWindow||window;e=n.event}if(!e)return e;try{m&&e.type===m.type&&e.srcElement===m.target&&(e=m)}catch(r){}if(!e.target){var i=e.type;switch(e.target=e.srcElement,e.currentTarget=t||e.srcElement,"mouseover"===i&&(e.relatedTarget=e.fromElement),"mouseout"===i&&(e.relatedTarget=e.toElement),e.stopPropagation||(e.stopPropagation=D,e.preventDefault=T),i){case"keypress":var o="charCode"in e?e.charCode:e.keyCode;10===o?(o=0,e.keyCode=13):13===o||27===o?o=0:3===o&&(o=99),e.charCode=o}}return e};var m,y=[],g=function(){var e=Function("event","var callee = arguments.callee; for(var i = 0; i<callee.listeners.length; i++){var listener = callee._IEListeners_[callee.listeners[i]]; if(listener){listener.call(this,event);}}");return e._IEListeners_=y,e},w=function(e){this.handle=e};w.prototype.remove=function(){delete y[this.handle]};var E=function(e){return function(t){t=p._fixEvent(t,this);var n=e.call(this,t);return t.modified&&(m||setTimeout(function(){m=null}),m=t),n}},b=function(e,t,n){if(n=E(n),(e.ownerDocument?e.ownerDocument.parentWindow:e.parentWindow||e.window||window)!=top||r("jscript")<5.8){var o=e[t];if(!o||!o.listeners){var a=o;o=g(),o.listeners=[],e[t]=o,o.global=this,a&&o.listeners.push(y.push(a)-1)}var c;return o.listeners.push(c=y.push(n)-1),new w(c)}return i.after(e,t,n,!0)},D=function(){this.cancelBubble=!0},T=p._preventDefault=function(){if(this.bubbledKeyCode=this.keyCode,this.ctrlKey)try{this.keyCode=0}catch(e){}this.defaultPrevented=!0,this.returnValue=!1,this.modified=!0}}if(r("touch"))var P=window.orientation,C=function(e){return function(t){var n=t.corrected;if(!n){var i=t.type;try{delete t.type}catch(o){}if(t.type){if(r("touch-can-modify-event-delegate"))EventDelegate.prototype=t,n=new EventDelegate;else{n={};for(var a in t)n[a]=t[a]}n.preventDefault=function(){t.preventDefault()},n.stopPropagation=function(){t.stopPropagation()}}else n=t,n.type=i;if(t.corrected=n,"resize"===i)return P===window.orientation?null:(P=window.orientation,n.type="orientationchange",e.call(this,n));"rotation"in n||(n.rotation=0,n.scale=1);var c=n.changedTouches[0];for(var u in c)delete n[u],n[u]=c[u]}return e.call(this,n)}};return p.parse=function(e,t,n,r,i){if(t.call)return t.call(i,e,n);var o,a,c,s;if(t instanceof Array?o=t:t.indexOf(",")>-1&&(o=t.split(u)),o&&1===o.length&&(t=o[0],o=!1),o){for(c=[],a=0;s=o[a++];)c.push(s.call?s.call(i,e,n):r(e,s,n,i));return c.remove=function(){for(var e=0;e<c.length;e++)c[e].remove()},c}return r(e,t,n,i)},p.once=function(e,t,n){var r=p(e,t,function(){return r.remove(),n.apply(this,arguments)});return r},p.pausable=function(e,t,n){var r,i=p(e,t,function(){return r?void 0:n.apply(this,arguments)});return i.pause=function(){r=!0},i.resume=function(){r=!1},i},p.selector=function(e,t,n){return function(r,i){function a(t){for(;!u(t,e,r);)if(t===r||n===!1||!(t=t.parentNode)||1!==t.nodeType)return;return t}var c=t.bubble,u="function"==typeof e?e:o.matchesSelector;return c?p(r,c(a),i):p(r,t,function(e){var t=a(e.target);return t?(e.expectedTarget=t,i.call(t,e)):void 0})}},p});
define("base/mouse",["require","exports","module","./on","./sniff","./dom"],function(require,exports,module){function e(n,o){var u=function(e,u){return t(e,n,function(t){return o?o(t,u):i(t.relatedTarget,e)?void 0:(t.matchedTarget=this,u.call(this,t))})};return u.bubble=function(t){return e(n,function(e,n){var o=t(e.target),i=e.relatedTarget;return o&&o!==(i&&1===i.nodeType&&t(i))?(e.matchedTarget=o,n.call(o,e)):void 0})},u}var t=require("./on"),n=require("./sniff"),o=require("./dom"),i=o.isDescendant,u=(window,document);n.add("dom-quirks",u&&"BackCompat"==u.compatMode),n.add("events-mouseenter",u&&"onmouseenter"in u.createElement("div")),n.add("events-mousewheel",u&&"onmousewheel"in u);var r;r=n("dom-quirks")&&n("ie")||!n("dom-addeventlistener")?{LEFT:1,MIDDLE:4,RIGHT:2,isButton:function(e,t){return e.button&t},isLeft:function(e){return 1&e.button},isMiddle:function(e){return 4&e.button},isRight:function(e){return 2&e.button}}:{LEFT:0,MIDDLE:1,RIGHT:2,isButton:function(e,t){return e.button==t},isLeft:function(e){return 0==e.button},isMiddle:function(e){return 1==e.button},isRight:function(e){return 2==e.button}};var s;s=n("events-mousewheel")?"mousewheel":function(e,n){return t(e,"DOMMouseScroll",function(e){e.wheelDelta=-e.detail,n.call(this,e)})},module.exports={_eventHandler:e,enter:e("mouseover"),leave:e("mouseout"),wheel:s,isLeft:r.isLeft,isMiddle:r.isMiddle,isRight:r.isRight}});
define("base/json",["require","exports","module","./has"],function(require,exports,module){var n,r=require("./has"),e="undefined"!=typeof JSON;if(r.add("json-parse",e),e&&r.add("json-stringify","{'a':1}"===JSON.stringify({a:0},function(n,r){return r||1})),r("json-stringify"))n=JSON;else{var t=function(n){return('"'+n.replace(/(["\\])/g,"\\$1")+'"').replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")};n={parse:r("json-parse")?JSON.parse:function(n,r){if(r&&!/^([\s\[\{]*(?:"(?:\\.|[^"])*"|-?\d[\d\.]*(?:[Ee][+-]?\d+)?|null|true|false|)[\s\]\}]*(?:,|:|$))+$/.test(n))throw new SyntaxError("Invalid characters in JSON");return new Function("return "+n)()},stringify:function(n,r,e){function i(n,u,o){r&&(n=r(o,n));var a,s=typeof n;if("number"===s)return isFinite(n)?n+"":"null";if("boolean"===s)return n+"";if(null===n)return"null";if("string"===s)return t(n);if("function"===s||"undefined"===s)return f;if("function"==typeof n.toJSON)return i(n.toJSON(o),u,o);if(n instanceof Date)return'"{FullYear}-{Month+}-{Date}T{Hours}:{Minutes}:{Seconds}Z"'.replace(/\{(\w+)(\+)?\}/g,function(r,e,t){var i=n["getUTC"+e]()+(t?1:0);return 10>i?"0"+i:i});if(n.valueOf()!==n)return i(n.valueOf(),u,o);var l=e?u+e:"",c=e?" ":"",p=e?"\n":"";if(n instanceof Array){var g=n.length,d=[];for(o=0;g>o;o++){var y=n[o];a=i(y,l,o),"string"!=typeof a&&(a="null"),d.push(p+l+a)}return"["+d.join(",")+p+u+"]"}var v=[];for(o in n){var O;if(n.hasOwnProperty(o)){if("number"==typeof o)O='"'+o+'"';else{if("string"!=typeof o)continue;O=t(o)}if(a=i(n[o],l,o),"string"!=typeof a)continue;v.push(p+l+O+":"+c+a)}}return"{"+v.join(",")+p+u+"}"}var f;return"string"==typeof r&&(e=r,r=null),i(n,"","")}}}module.exports=n});
define("base/topic",["require","exports","module","./Evented"],function(require,exports,module){var e=require("./Evented"),n=new e;module.exports={subscribe:function(e,t){return n.on.apply(n,arguments)},publish:function(e,t){return n.emit.apply(n,arguments)}}});
define("base/Deferred",["require","exports","module","./lang"],function(require,exports,module){function e(){}function n(){throw new Error("abstract")}function r(e,n){var r=e.prototype;for(var t in n)r[t]=n[t];return e}function t(n,r,t,i){var o=n&&"function"==typeof n.then,c=o&&n instanceof e;if(!o)return arguments.length>1?r?r(n):n:(new y).resolve(n);if(!c){var f=new y(n.cancel);n.then(f.resolve,f.reject,f.progress),n=f.promise}return r||t||i?n.then(r,t,i):n}function i(e,n){var r,i;e instanceof Array?i=e:e&&"object"==typeof e&&(r=e);var o,c=[];if(r){i=[];for(var f in r)Object.hasOwnProperty.call(r,f)&&(c.push(f),i.push(r[f]));o={}}else i&&(o=[]);if(!i||!i.length)return(new y).resolve(o);var u=new y(n?function(e){return g(i,function(n){!n.isFulfilled||n.isCanceled()||n.isFulfilled()||n.cancel(e)}),e}:n);u.promise.always(function(){o=c=null});var s=i.length;return j(i,function(e,n){return r||c.push(n),t(e,function(e){u.isFulfilled()||(o[c[n]]=e,0===--s&&u.resolve(o))},u.reject),u.isFulfilled()||u.isCanceled()}),u.promise}var o=require("./lang");r(e,{then:function(e,r,t){n()},cancel:function(e){n()},isResolved:function(){n()},isRejected:function(){n()},isFulfilled:function(){n()},isCanceled:function(){n()},always:function(e){return this.then(e,e)},otherwise:function(e){return this.then(null,e)},toString:function(){return"[object Promise]"}});var c=0,f=1,u=2,s="This deferred has already been fulfilled.",l="The deferred was cancelled.",a=function(){},h=Object.freeze||a,d=function(e,n,r){for(var t=0;t<e.length;t++)v(e[t],n,r)},v=function(e,n,r){var t=e[n],i=e.deferred;if(t)try{var o=t(r);if(n===c)"undefined"!=typeof o&&w(i,n,o);else{if(o&&"function"==typeof o.then)return e.cancel=o.cancel,void o.then(p(i,f),p(i,u),p(i,c));w(i,f,o)}}catch(s){w(i,u,s),console.error&&console.error(s)}else w(i,n,r)},p=function(e,n){return function(r){w(e,n,r)}},w=function(e,n,r){if(!e.isCanceled())switch(n){case c:e.progress(r);break;case f:e.resolve(r);break;case u:e.reject(r)}},y=function(n){var r,t,i=this.promise=new e,o=!1,a=[];this.isResolved=i.isResolved=function(){return r===f},this.isRejected=i.isRejected=function(){return r===u},this.isFulfilled=i.isFulfilled=function(){return!!r},this.isCanceled=i.isCanceled=function(){return o},this.progress=function(e,n){if(r){if(n===!0)throw new Error(s);return i}return d(a,c,e),i},this.resolve=function(e,n){if(r){if(n===!0)throw new Error(s);return i}return d(a,r=f,t=e),a=null,i};var p=this.reject=function(e,n){if(r){if(n===!0)throw new Error(s);return i}return d(a,r=u,t=e),a=null,i};this.then=i.then=function(e,n,o){var c=[o,e,n];return c.cancel=i.cancel,c.deferred=new y(function(e){return c.cancel&&c.cancel(e)}),r&&!a?v(c,r,t):a.push(c),c.deferred.promise},this.cancel=i.cancel=function(e,i){if(r){if(i===!0)throw new Error(s)}else{if(n){var c=n(e);e="undefined"==typeof c?e:c}if(o=!0,!r)return"undefined"==typeof e&&(e=new Error(l)),p(e),e;if(r===u&&t===e)return e}},h(i)};y.prototype.toString=function(){return"[object Deferred]"},y.Promise=e;var j=o.some,g=o.each;return y.when=t,y.ensure=function(e,n){return i(e,n)},y});
define("app/app.config",["require","exports","module"],function(require,exports,module){var o="/",t=location.protocol+"//"+location.host+"/";return{ROUTE_ROOT:o,APP_HOST:t,APP_PATH:t+(o.length>1?o.substring(1)+"/":""),API_BASE:"/mock-json",APP_DOWNLOAD_LINK:"http://veryos.com",APP_AUTH_LINK:"http://veryos.com",APP_USER_CENTER:"http://veryos.com",APP_HOME:"/recommend",TOASTER_DELAY:1.5,AJAX_TIMEOUT:10}});
define("base/touch",["require","exports","module","./lang","./has","./on","./dom","./mouse"],function(require,exports,module){function e(e,t,o){return X&&o?function(e,t){return f(e,o,t)}:Y?function(o,n){var a=f(o,t,function(e){n.call(this,e),d=(new Date).getTime()}),c=f(o,e,function(e){(!d||(new Date).getTime()>d+1e3)&&n.call(this,e)});return{remove:function(){a.remove(),c.remove()}}}:function(t,o){return f(t,e,o)}}function t(e){do if(void 0!==e.dojoClick)return e;while(e=e.parentNode)}function o(e,o,d){function h(e){a=E?v.isDescendant(j.elementFromPoint(e.changedTouches?e.changedTouches[0].pageX-y.pageXOffset:e.clientX,e.changedTouches?e.changedTouches[0].pageY-y.pageYOffset:e.clientY),c):a&&(e.changedTouches?e.changedTouches[0].target:e.target)==c&&Math.abs((e.changedTouches?e.changedTouches[0].pageX-y.pageXOffset:e.clientX)-u)<=i&&Math.abs((e.changedTouches?e.changedTouches[0].pageY-y.pageYOffset:e.clientY)-r)<=s}function m(e){j.addEventListener(e,function(t){!t._dojo_click&&(new Date).getTime()<=g+1e3&&(t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),"click"!=e||"INPUT"==t.target.tagName&&"radio"!=t.target.type&&"checkbox"!=t.target.type||"TEXTAREA"==t.target.tagName||"AUDIO"==t.target.tagName||"VIDEO"==t.target.tagName||t.preventDefault())},!0)}var l=t(e.target);a=!e.target.disabled&&l&&l.dojoClick,a&&(E="useTarget"==a,c=E?l:e.target,E&&e.preventDefault(),u=e.changedTouches?e.changedTouches[0].pageX-y.pageXOffset:e.clientX,r=e.changedTouches?e.changedTouches[0].pageY-y.pageYOffset:e.clientY,i=("object"==typeof a?a.x:"number"==typeof a?a:0)||4,s=("object"==typeof a?a.y:"number"==typeof a?a:0)||4,n||(n=!0,j.addEventListener(o,function(e){h(e),E&&e.preventDefault()},!0),j.addEventListener(d,function(e){if(h(e),a){g=(new Date).getTime();var t=E?c:e.target;"LABEL"===t.tagName&&(t=v.byId("#"+t.getAttribute("for"))||t);var o=e.changedTouches?e.changedTouches[0]:e,n=document.createEvent("MouseEvents");n._dojo_click=!0,n.initMouseEvent("click",!0,!0,e.view,e.detail,o.screenX,o.screenY,o.clientX,o.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,0,null),setTimeout(function(){f.emit(t,"click",n),g=(new Date).getTime()},0)}},!0),m("click"),m("mousedown"),m("mouseup")))}var n,a,c,u,r,i,s,g,d,h,m=require("./lang"),l=require("./has"),f=require("./on"),v=require("./dom"),p=require("./mouse"),T=require.ready,b=l("ios")<5,y=window,j=document,w=function(){return j.body||j.getElementsByTagName("body")[0]},X=l("pointer-events")||l("MSPointer"),D=function(){var e={};for(var t in{down:1,move:1,up:1,cancel:1,over:1,out:1})e[t]=l("MSPointer")?"MSPointer"+t.charAt(0).toUpperCase()+t.slice(1):"pointer"+t;return e}(),Y=l("touch-events"),E=!1;X?T(function(){j.addEventListener(D.down,function(e){o(e,D.move,D.up)},!0)}):Y&&T(function(){function e(e){var t=m.delegate(e,{bubbles:!0});return l("ios")>=6&&(t.touches=e.touches,t.altKey=e.altKey,t.changedTouches=e.changedTouches,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.shiftKey=e.shiftKey,t.targetTouches=e.targetTouches),t}h=w(),j.addEventListener("touchstart",function(e){d=(new Date).getTime();var t=h;h=e.target,f.emit(t,"dojotouchout",{relatedTarget:h,bubbles:!0}),f.emit(h,"dojotouchover",{relatedTarget:t,bubbles:!0}),o(e,"touchmove","touchend")},!0),f(j,"touchmove",function(t){d=(new Date).getTime();var o=j.elementFromPoint(t.pageX-(b?0:y.pageXOffset),t.pageY-(b?0:y.pageYOffset));o&&(h!==o&&(f.emit(h,"dojotouchout",{relatedTarget:o,bubbles:!0}),f.emit(o,"dojotouchover",{relatedTarget:h,bubbles:!0}),h=o),f.emit(o,"dojotouchmove",e(t))||t.preventDefault())}),f(j,"touchend",function(t){d=(new Date).getTime();var o=j.elementFromPoint(t.pageX-(b?0:y.pageXOffset),t.pageY-(b?0:y.pageYOffset))||w();f.emit(o,"dojotouchend",e(t))})});var K={tap:Y&&v.gesture&&v.gesture.tap?v.gesture.tap:"click",press:e("mousedown","touchstart",D.down),move:e("mousemove","dojotouchmove",D.move),release:e("mouseup","dojotouchend",D.up),cancel:e(p.leave,"touchcancel",X?D.cancel:null),over:e("mouseover","dojotouchover",D.over),out:e("mouseout","dojotouchout",D.out),enter:p._eventHandler(e("mouseover","dojotouchover",D.over)),leave:p._eventHandler(e("mouseout","dojotouchout",D.out))};return K});
define("base/kernel",["require","exports","module","./lang","./Evented"],function(require,exports,module){"use strict";var e=require("./lang"),n=require("./Evented"),l=function(){return this}.call(this||window),o=e.mix(l.ksconfig||{},{global:"KS",scopeName:"ks",parseOnReady:!1}),r=e.delegate({version:function(){return"1.0.0"},config:o,global:l},new n);return o.global&&(l[o.global]=r),r});
define("app/ajax",["require","exports","module","base/lang","base/Deferred","base/topic","base/json","jquery","./app.config"],function(require,exports,module){function e(e,r,a){var n=t.indexOf(o.stack,r);-1!==n&&o.stack.splice(n,1),p-=1,a.quiet||(l-=1),s.publish("/app/load/complete",e),0===l&&(d=t.delay(function(){s.publish("/app/load/idle")},200))}function r(e){!e.quiet&&d&&(d.remove(),d=null),e.quiet||l||s.publish("/app/load/start",e),p+=1,e.quiet||(l+=1)}function a(e,r){return e&&"json"===r.toLowerCase()?i.stringify(e):e}function o(t){var i,u=new n(function(){i&&i.abort(),s.publish("/app/load/abort",i)});r(t);var p=u.promise,l=t.type||"GET",d=t.dataType||"json",f=t.paramType||"query",h=t.contentType||"application/json;charset=UTF-8",b=t.data?a(t.data,f):t.data,m={url:t.url,contentType:h,dataType:d,type:l,data:b,headers:t.headers,timeout:1e3*o.timeout,cache:void 0!==t.cache?t.cache:!1,skipError:t.skipError};return i=c(m),o.stack.push(p),i.then(function(r,a,o){var n,c;"json"===d&&t.skipError?u.resolve(r):"json"!==d||200===+(n=(r.error?r.error.code:r.resultCode)||200)?(u.resolve("json"===d?r.data:r),s.publish("/app/load/success",{data:r,xhr:o,param:m})):(c={catchFrom:"apiError",xhr:o,type:"api",code:+(r.error?r.error.code:r.resultCode)||-99999,message:(r.error?r.error.message:r.resultDesc)||"unknow"},u.reject(c),t.skipError||s.publish("/app/load/error",c)),e(i,p,t)},function(r,a,o){var n={catchFrom:"ajaxError",xhr:r,type:a,code:o&&o.code||r.status||-99999,message:o&&o.message||r.statusText||"unknow",rawError:o};u.reject(n),t.skipError||s.publish("/app/load/error",n),e(i,p,t)}),p}var t=require("base/lang"),n=require("base/Deferred"),s=require("base/topic"),i=require("base/json"),c=require("jquery").ajax,u=require("./app.config"),p=0,l=0,d=null;return t.mix(o,{timeout:u.AJAX_TIMEOUT||10,stack:[],abort:function(){var e=o.stack.slice(0);o.stack=[],t.forEach(e,function(e){e.isFulfilled()||e.cancel({type:"abort"})}),e=null},parallel:function(e){var r=[],a={};t.forEach(e,function(e,t){var n=o(e);r.push(n),n.then(function(r){var o=e.alias||t+"";r.__alias=o,a[o]=r})});var s=n.ensure(r,!0),i=new n(function(e){s.cancel(e)});return s.then(function(){i.resolve(a)},function(e){i.reject(e)}),i.promise},serializeParam:a,getFlight:function(){return l}}),o.load=o,o.request=o.parallel,o});
define("base/registry",["require","exports","module"],function(require,exports,module){"use strict";var e={},t={};return{uid:function(e){e=e.replace(/\./g,"_").toLowerCase();var i=e in t?t[e]:t[e]=-1;return e+"_"+(t[e]=++i)},length:0,add:function(t){if(e[t.id])throw new Error('Widget with id "'+t.id+'" is already registered!');e[t.id]=t,this.length++},remove:function(t){e[t]&&(delete e[t],this.length--)},byId:function(t){return e[t]},byNode:function(t){return e[t.getAttribute("widgetid")]},findWidgets:function(t,i){function r(t){for(var d=t.firstChild;d;d=d.nextSibling)if(1===d.nodeType){var u=d.getAttribute("widgetid");if(u){var o=e[u];o&&n.push(o)}else d!==i&&r(d)}}var n=[];return r(t),n},getEnclosingWidget:function(t){for(;t;){var i=1===t.nodeType&&t.getAttribute("widgetid");if(i)return e[i];t=t.parentNode}return null}}});
define("base/Stateful",["require","exports","module","./lang","./declare","./Deferred"],function(require,exports,module){var t=require("./lang"),e=require("./declare"),i=require("./Deferred"),r=Array.prototype.slice;return e("base.Stateful",null,{__accessors:{},__getAccessor:function(e){var i=this.__accessors;if(i[e])return i[e];var r=t.camelize(e);return i[e]={s:"_"+r+"Setter",g:"_"+r+"Getter"}},postscript:function(t){t&&this.set(t)},_get:function(t,e){return this[t]},get:function(e){var i=this.__getAccessor(e);return t.isFunction(this[i.g])?this[i.g]():this._get(e)},_set:function(e,r){var s=this.__getAccessor(e),n=this._get(e,s);if(this[e]=r,!t.isEqual(n,r)&&this.__notify){var o=this;i.when(r,function(){o.__notify(e,n,r)})}},set:function(e,i){if("object"==typeof e){for(var s in e)e.hasOwnProperty(s)&&"__notify"!==s&&this.set(s,e[s]);return this}var n,o=this.__getAccessor(e),c=this[o.s];return t.isFunction(c)&&(n=c.apply(this,r.call(arguments,1))),this._set(e,void 0===n?i:n),this},watch:function(e,i){var r=this.__notify;if(!r){var s=this;r=this.__notify=function(t,e,i,n){var o=function(r){if(r){r=r.slice();for(var n=0,o=r.length;o>n;n++)r[n].call(s,t,e,i)}};o(r["_"+t]),n||o(r["*"])}}i||"function"!=typeof e?e="_"+e:(i=e,e="*");var n=r[e];"object"!=typeof n&&(n=r[e]=[]),n.push(i);var o={};return o.remove=function(){var e=t.indexOf(n,i);e>-1&&n.splice(e,1)},o}})});
define("base/_AttachMixin",["require","exports","module","./lang","./declare","./on","./mouse","./touch"],function(require,e,t,i,n,s,r,o,h){var n=require("./lang"),i=require("./declare"),r=require("./on"),s=require("./mouse"),o=require("./touch"),a=n.delegate(o,{mouseenter:s.enter,mouseleave:s.leave});return i("base._AttachMixin",null,{constructor:function(){this.__nodes=[],this.__events=[]},buildRendering:function(){this.inherited(arguments),this.__attach(this.domNode),this.__prefill()},__prefill:n.noop,__attach:function(e){for(var t=e;;)if(1==t.nodeType&&this.__process(t,function(e,t){return e.getAttribute(t)},this.__listen)&&t.firstChild)t=t.firstChild;else{if(t==e)return;for(;!t.nextSibling;)if(t=t.parentNode,t==e)return;t=t.nextSibling}},__process:function(e,t,i){var s=!0,r=this.attachScope||this,o=t(e,"ks-node");if(o)for(var h,a=o.split(/\s*,\s*/);h=a.shift();)n.isArray(r[h])?r[h].push(e):r[h]=e,dow="containerNode"!=h,this.__nodes.push(h);var c=t(e,"ks-event");if(c)for(var l,u=c.split(/\s*,\s*/),f=n.trim;l=u.shift();)if(l){var d=null;if(-1!==l.indexOf(":")){var v=l.split(":");l=f(v[0]),d=f(v[1])}else l=f(l);d||(d=l),this.__events.push(i(e,l,n.hitch(r,d)))}return s},__listen:function(e,t,i){t=t.replace(/^on/,"");var n=t.match(/(.*)@(.*)/);return n&&a[n[1]]?(t=a[n[1]],n=n[2],r.selector(n,t).call(this,e,i)):(t=a[t]||t,r(e,t,i))},__detach:function(){var e=this.attachScope||this;n.forEach(this.__nodes,function(t){delete e[t]}),this.__nodes=[],n.forEach(this.__events,function(e){e.remove()}),this.__events=[]},destroyRendering:function(){this.__detach(),this.inherited(arguments)}})});
define("app/services",["require","exports","module","base/lang","base/Deferred","./app.config","./ajax"],function(require,exports,module){function e(e,n,t){return e=u+e,t=t||{},void 0===t.cache&&(t.cache=!1),a(r.mix({url:e,data:n},t))}function n(n,r,t){return n+=".json",e(n,r,t)}var r=require("base/lang"),t=(require("base/Deferred"),require("./app.config")),a=require("./ajax"),u=t.API_BASE,o={};return o.getUser=function(e,r){return n("/user",e,r)},o.getEntryHome=function(e,r){return n("/home",e,r)},o.getEntryAbout=function(e,r){return n("/about",e,r)},o});
define("base/parser",["require","exports","module","./lang","./Deferred","./kernel","./dom"],function(require,exports,module){function e(e,r){var n=new Function("with(this){return ("+e+")}").call(r);for(var a in n){var o=n[a];"function"==typeof o&&(n[a]=t.hitch(r,o))}return n}var t=require("./lang"),r=require("./Deferred"),n=require("./kernel"),a=require("./dom"),o={instantiate:function(e,r,a){r=r||{},a=a||{};var o=(a.scope||n.config.scopeName)+"-",i=o+"type",s=[];return t.forEach(e,function(e){var t=r.type||e.getAttribute(i);t&&s.push({node:e,type:t})}),this._instantiate(s,r,a)},_instantiate:function(e,n,a){var o=a.contextRequire||require,i=t.map(e,function(e){var t=e.ctor||o(e.type);if(!t)throw new Error("Unable to resolve constructor for: '"+e.type+"'");return this.construct(t,e.node,n,a)},this);return r.ensure(i).then(function(e){return n.__started||a.noStart||t.forEach(e,function(e){"function"!=typeof e.startup||e.__started||e.startup()}),e})},construct:function(r,a,o,i){var s=r&&r.prototype;i=i||{};var c={};i.defaults&&t.mix(c,i.defaults);var p=i.scope||n.config.scopeName,u=p+"-",f={};"ks"!==p&&(f[u+"props"]="ks-props",f[u+"type"]="ks-type",f[u+"id"]="ks-id");for(var l,d,h=a.attributes,y=0;l=h[y++];){var v=l.name,k=v.toLowerCase(),m=l.value;switch(f[k]||k){case"ks-type":break;case"ks-props":d=m;break;case"ks-id":c.id=m;break;case"ks-name":c.ksAttachName=m;break;case"ks-event":c.ksAttachEvent=m;break;case"style":c.style=a.style&&a.style.cssText;break;default:c[v]=m}}if(d)try{d=e("{"+d+"}",i.context),t.mix(c,d)}catch(b){return b}t.mix(c,o);var x=r.markupFactory||s.markupFactory,g=x?x(c,a,r):new r(c,a);return g.then?g.then(function(e){return e}):g},scan:function(e,a){for(var o,i=[],s=[],c=a.scope||n.config.scopeName,p=c+"-",u=p+"type",f=a.contextRequire||require,l=e.firstChild,d={};;)if(l)if(1===l.nodeType)if(o||/^script$|^style$|^link$/.test(l.nodeName.toLowerCase()))l=l.nextSibling;else{var h=l.getAttribute(u),y=l.firstChild;if(h||y&&(3!==y.nodeType||y.nextSibling)){var v,k=null;if(h){try{k=f(h)}catch(m){}!k&&~h.indexOf("/")&&s.push(h),v={type:h,ctor:k,parent:d,node:l},i.push(v)}else v={node:l,parent:d};o=l.stopParser||k&&k.prototype.stopParser&&!a.template,d=v,l=y}else l=l.nextSibling}else l=l.nextSibling;else{if(!d||!d.node)break;l=d.node.nextSibling,o=!1,d=d.parent}var b=new r;return s.length?(s=t.unique(s),f(s,function(){b.resolve(t.filter(i,function(e){if(!e.ctor)try{e.ctor=f(e.type)}catch(t){}for(var r=e.parent;r&&!r.type;)r=r.parent;var n=e.ctor&&e.ctor.prototype;return e.instantiateChildren=!(n&&n.stopParser&&!a.template),e.instantiate=!r||r.instantiate&&r.instantiateChildren,e.instantiate}))})):b.resolve(i),b.promise},parse:function(e,r){var n;!r&&e&&e.rootNode?(r=e,n=r.rootNode):!e||!t.isObject(e)||"nodeType"in e?n=e:r=e,n=n?a.byId(n):document.body,r=r||{};var o=r.template?{template:!0}:{},i=[],s=this,c=this.scan(n,r).then(function(e){return s._instantiate(e,o,r)}).then(function(e){return i=i.concat(e)}).otherwise(function(e){throw console.error("base/parser::parse() error",e),e});return t.mix(i,c),i}};return n.config.parseOnReady&&require.ready(t.hitch(o,"parse")),o});
define("base/_WidgetBase",["require","exports","module","./lang","./declare","./Stateful","./aspect","./on","./dom","./registry","./url!./resources/blank.gif"],function(require,exports,module){var t=require("./lang"),e=require("./declare"),s=require("./Stateful"),i=require("./aspect"),o=require("./on"),r=require("./dom"),n=require("./registry"),d=require("./url!./resources/blank.gif");return e("base._WidgetBase",s,{id:"",_idSetter:function(t){r.attr(this.domNode,"id",t),r.attr(this.domNode,"widgetid",t)},style:"",_styleSetter:function(t){var e=this.domNode;"object"==typeof t?r.css(e,t):e.style.cssText?e.style.cssText+="; "+t:e.style.cssText=t},baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,blankGif:d,postscript:function(t,e){this.create(t,e)},create:function(e,s){this.__introspect(),this.srcNodeRef=s,e&&(this.__params=e,t.mix(this,e)),this.postMixInProperties(),this.id||(this.id=n.uid(this.declaredClass),this.params&&delete this.params.id),this.ownerDocument=this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:document),this.ownerDocumentBody=this.ownerDocument.body,n.add(this),this.buildRendering();var i;if(this.domNode){this.__assign();var o=this.srcNodeRef;o&&o.parentNode&&this.domNode!==o&&(o.parentNode.replaceChild(this.domNode,o),i=!0),this.domNode.setAttribute("widgetid",this.id)}this.postCreate(),i&&delete this.srcNodeRef,this.__created=!0},__introspect:function(){var t=this.constructor;if(!t.__setters){var e=t.prototype,s=t.__setters=[];for(var i in e)/^_(.*)Setter$/.test(i)&&(i=i.substr(1,i.length-7),s.push(i))}},__assign:function(){var e={};for(var s in this.__params||{})e[s]=this._get(s);t.forEach(this.constructor.__setters,function(t){if(!(t in e)){var s=this._get(t);void 0!==s&&this.set(t,s)}},this);for(s in e)this.set(s,e[s])},postMixInProperties:function(){for(var e=[],s=this.constructor;s;){var i="function"==typeof s?s.prototype:s;i.hasOwnProperty("baseClass")&&i.baseClass&&e.unshift(i.baseClass),s=i.constructor.superclass}this.hasOwnProperty("baseClass")&&this.baseClass&&e.push(this.baseClass),e=e.join(" ").split(" "),this.baseClass=t.unique(e).join(" ")},buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div")),this.baseClass&&r.addClass(this.domNode,this.baseClass)},postCreate:t.noop,startup:function(){this.__started||(this.__started=!0,t.forEach(this.getChildren(),function(e){e.__started||e.__destroyed||!t.isFunction(e.startup)||(e.startup(),e.__started=!0)}))},destroyRecursive:function(t){this.__beingDestroyed=!0,this.destroyDescendants(t),this.destroy(t)},destroy:function(e){function s(t){t.destroyRecursive?t.destroyRecursive(e):t.destroy&&t.destroy(e)}this.__beingDestroyed=!0,this.domNode&&t.forEach(n.findWidgets(this.domNode,this.containerNode),s),this.destroyRendering(e),n.remove(this.id),this.__destroyed=!0},destroyRendering:function(t){this.domNode&&(t?r.removeAttr(this.domNode,"widgetid"):r.remove(this.domNode),delete this.domNode),this.srcNodeRef&&(t||r.remove(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(e){t.forEach(this.getChildren(),function(t){t.destroyRecursive&&t.destroyRecursive(e)})},own:function(){var e=["destroyRecursive","destroy","remove"];return t.forEach(arguments,function(s){function o(){n.remove(),t.forEach(d,function(t){t.remove()})}var r,n=i.before(this,"destroy",function(t){s[r](t)}),d=[];s.then?(r="cancel",s.then(o,o)):t.forEach(e,function(t){"function"==typeof s[t]&&(r||(r=t),d.push(i.after(s,t,o,!0)))})},this),arguments},__accessors:{},_set:function(t,e){var s=this.__getAccessor(t),i=this._get(t,s);this.__created?(this.inherited(arguments),this.emit(t+":change",{detail:{name:t,previous:i,value:e}})):this[t]=e},emit:function(t,e,s){e=e||{},void 0===e.bubbles&&(e.bubbles=!0),void 0===e.cancelable&&(e.cancelable=!0),e.detail||(e.detail={}),e.detail.widget=this,this.__started&&!this.__beingDestroyed&&o.emit(this.domNode,t,e)},on:function(t,e){return this.own(o(this.domNode,t,e))[0]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getChildren:function(){return this.containerNode?n.findWidgets(this.containerNode):[]},getParent:function(){return n.getEnclosingWidget(this.domNode.parentNode)},placeAt:function(t,e){var s="string"==typeof t?r.byId(t,this.ownerDocument):t;if(r.place(this.domNode,s,e),!this.__started){var i=this.getParent();i&&!i.__started||this.startup()}return this},defer:function(e,s){var i=setTimeout(t.hitch(this,function(){i&&(i=null,this.__destroyed||t.hitch(this,e)())}),s||0);return{remove:function(){return i&&(clearTimeout(i),i=null),null}}}})});
define("base/_WidgetsInTemplateMixin",["require","exports","module","./kernel","./lang","./declare","./parser"],function(require,exports,module){var e=require("./kernel"),t=require("./lang"),i=require("./declare"),r=require("./parser");return i("base._WidgetsInTemplateMixin",null,{widgetsInTemplate:!1,contextRequire:null,__prefill:function(){if(this.widgetsInTemplate){var i=this.domNode;if(r.parse(i,{noStart:!0,template:!0,context:this,contextRequire:this.contextRequire,scope:e.config.scopeName}).then(t.hitch(this,function(e){this.__startupWidgets=e;for(var t=0,i=e.length;i>t;++t)this.__process(e[t],function(e,t){return e[t]},function(e,t,i){return e.on(t,i,!0)})})),!this.__startupWidgets)throw new Error(this.declaredClass+": parser returned unfilled promise (probably waiting for module auto-load), unsupported by _WidgetsInTemplateMixin.   Must pre-load all supporting widgets before instantiation.")}},__process:function(e,t,i){return t(e,"ks-type")?!0:this.inherited(arguments)},startup:function(){t.forEach(this.__startupWidgets,function(e){e&&!e._started&&e.startup&&e.startup()}),delete this.__startupWidgets,this.inherited(arguments)}})});
define("base/router",["require","exports","module","./lang","./Evented","jquery"],function(require,exports,module){var t=require("./lang"),e=require("./Evented"),$=require("jquery"),i=new e,s={},a=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},h=/\((.*?)\)/g,r=/(\(\?)?:\w+/g,n=/\*\w+/g,o=/[\-{}\[\]+?.,\\\^$|#\s]/g;t.mix(a.prototype,i,{initialize:function(){},route:function(e,i,a){t.isRegExp(e)||(e=this._routeToRegExp(e)),t.isFunction(i)&&(a=i,i=""),a||(a=this[i]);var h=this;return s.history.route(e,function(t){var r=h._extractParameters(e,t);h.execute(a,r,this.route),h.emit.apply(h,["route:"+i].concat(r)),h.emit("route",i,r),s.history.emit("route",h,i,r)}),this},execute:function(t,e){t&&t.apply(this,e)},navigate:function(t,e){return s.history.navigate(t,e),this},_bindRoutes:function(){if(this.routes){this.routes=t.result(this,"routes");for(var e,i=t.keys(this.routes);null!=(e=i.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(t){return t=t.replace(o,"\\$&").replace(h,"(?:$1)?").replace(r,function(t,e){return e?t:"([^/?]+)"}).replace(n,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,i){var s=e.exec(i).slice(1);return t.map(s,function(t,e){return e===s.length-1?t||null:t?decodeURIComponent(t):null})}});var c=function(){this.handlers=[],t.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},u=/^[#\/]|\s+$/g,l=/^\/+|\/+$/g,g=/msie [\w.]+/,f=/\/$/,p=/#.*$/;return c.started=!1,t.mix(c.prototype,i,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getFragment:function(t,e){if(null==t)if(this._hasPushState||!this._wantsHashChange||e){t=decodeURI(this.location.pathname+this.location.search);var i=this.root.replace(f,"");t.indexOf(i)||(t=t.slice(i.length))}else t=this.getHash();return t.replace(u,"")},start:function(e){if(!c.started){c.started=!0,this.options=t.mix({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var i=this.getFragment(),s=document.documentMode,a=g.exec(navigator.userAgent.toLowerCase())&&(!s||7>=s);if(this.root=("/"+this.root+"/").replace(l,"/"),a&&this._wantsHashChange){var h=$('<iframe src="javascript:0" tabindex="-1">');this.iframe=h.hide().appendTo("body")[0].contentWindow,this.navigate(i)}this._hasPushState?$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!a?$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=i;var r=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&r.hash&&(this.fragment=this.getHash().replace(u,""),this.history.replaceState({},document.title,this.root+this.fragment))}return this.options.silent?void 0:this.loadUrl()}},stop:function(){$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),c.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(t){var e=this.getFragment();return e===this.fragment&&this.iframe&&(e=this.getFragment(this.getHash(this.iframe))),e===this.fragment?!1:(this.iframe&&this.navigate(e),void this.loadUrl())},loadUrl:function(e){return e=this.fragment=this.getFragment(e),t.any(this.handlers,function(t){return t.route.test(e)?(t.callback(e),!0):void 0})},navigate:function(t,e){if(!c.started)return!1;e&&e!==!0||(e={trigger:!!e});var i=this.root+(t=this.getFragment(t||""));if(t=t.replace(p,""),this.fragment!==t){if(this.fragment=t,""===t&&"/"!==i&&(i=i.slice(0,-1)),this._hasPushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,t,e.replace))}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,i){if(i){var s=t.href.replace(/(javascript:|#).*$/,"");t.replace(s+"#"+e)}else t.hash="#"+e}}),s.history=new c,s.Router=a,s});
define("app/common",["require","exports","module","base/lang","base/sniff","base/Deferred","base/dom","./app.config","./services"],function(require,exports,module){function e(e){return a.raw?e?a.raw[e]:a.raw:void 0}function r(e){return!a.raw&&s.isPlainObject(e)?a.raw=e:s.isObject(e)?s.mix(a.raw,e):a.raw=null}function n(n,u){if(!n&&a.lastUpdateTime&&s.now()-a.lastUpdateTime<i){var c=new o;return c.resolve(e()),c.promise}if(a.promise)return a.promise;var m=a.promise=t.getUser({skipError:!0,quiet:u});return m.then(function(e){e&&200==e.resultCode&&r(e.data)}).always(function(){a.lastUpdateTime=s.now(),a.promise=null}),m}var s=require("base/lang"),o=(require("base/sniff"),require("base/Deferred")),t=(require("base/dom"),require("./app.config"),require("./services")),a={raw:null,lastUpdateTime:null,promise:null},i=6e5,u={getCtor:function(e){var r=new o;return require.async([e],function(e){r.resolve(e)}),r.promise},getInstanceOf:function(e,r,n){var s=new o;return require.async([e],function(e){try{s.resolve(e(r,n))}catch(o){s.reject({type:"rendering",code:-9999,message:o.message,rawError:o})}}),s.promise},consumeError:function(e,r){e&&!u.isConsumedError(e)&&(e.consumed=!0,r&&r(e))},isConsumedError:function(e){return e.consumed},setUser:r,getUser:e,checkUser:n};return u});
define("base/_TemplatedMixin",["require","exports","module","./lang","./declare","./dom","./_AttachMixin"],function(require,exports,module){var e=require("./lang"),i=require("./declare"),t=require("./dom"),r=require("./_AttachMixin"),n=i("base._TemplatedMixin",r,{templateString:null,_rendered:!1,escapeHTML:e.escape,buildRendering:function(){if(!this.__rendered){var i=this.templateString,r=e.isFunction(i);r||(i=i.replace(/>([\n\t]*)</g,"><"));var d=r?i:n.compile(i),a=t.parse(d(this));if(1!==a.childNodes.length)throw new Error("Invalid template: "+(r?i.source:i));var l=a.childNodes[0];this.domNode=l}this.inherited(arguments),this.__rendered||this.__fill(this.srcNodeRef),this.__rendered=!0},__fill:function(e){var i=this.containerNode;if(e&&i)for(;e.hasChildNodes();)i.appendChild(e.firstChild)}});return n.cache={},n.compile=function(i){var t=n.cache,r=e.trim(i),d=t[r];return d||(d=t[r]=e.template(i=r)),d},n});
define("app/routes",["require","exports","module","base/lang","base/declare","base/Deferred","base/router","base/topic","base/dom","./app.config","./common","./services"],function(require,exports,module){function e(e,r){return r=r||1,e[e.length-r]}var r=require("base/lang"),t=require("base/declare"),o=require("base/Deferred"),n=require("base/router"),i=require("base/topic"),a=(require("base/dom"),require("./app.config")),s=require("./common"),c=require("./services"),u=t("app.Router",n.Router,{initialize:function(){var e=r.hitch(this,"route"),t=r.hitch(this,"transform");e("*action","404",function(){f.navigate("/404",!0,!0)}),e("404(/)(?:query)","errror.404",function(){t("app/entry.Error")}),e("(?:query)","home",function(e){t("app/entry.Home",null,c.getEntryHome())}),e("about(/)(?:query)","toplist",function(){t("app/entry.About",null,c.getEntryAbout())})},execute:function(){var e=f.getFragment();!this._promiser||this._promiser.isFulfilled()||this._promiser.isCanceled()||(this._promiser.cancel({type:"abort"}),delete this._promiser),f.refreshState(e),i.publish("/app/route/access",e),this.inherited(arguments)},transform:function(e,t,n){this._promiser=o.ensure({data:n,ctor:s.getCtor(e)},!0),this._promiser.then(r.hitch(this,function(e){var r,o;t=t||{},e.data&&(t.data=e.data);try{r=e.ctor(t)}catch(n){o=n}o?this.onTransformError({type:"rendering",message:o.message,code:o.code||-99999,rawError:o}):this.onTransformEnd(r)}),r.hitch(this,"onTransformError"))},onTransformEnd:function(e){if(s.viewport)try{s.viewport.destroy()}catch(r){}e.placeAt("app-main","only"),s.viewport=e},onTransformError:function(e){s.consumeError(e,function(e){var r=f.getFragment();if(console&&(console.error?console.error(e):console.log&&console.log(e)),"api"===e.type&&402==e.code)return i.publish("/app/route/reject",r);if("abort"!==e.type){var t=encodeURIComponent("/"+r);f.navigate("/404?url="+t,!0,!0)}})}}),p=[],f={router:new u,history:[],refreshState:function(r){var t=e(p),o=e(p,2);void 0!==o&&r===o?(f.isBackward=!0,p.pop()):t!==r&&p.push(r)},getFragment:function(){return n.history.getFragment()},back:function(){p.length<2?f.navigate(a.APP_HOME,!0):window.history.back()},navigate:function(e,r,t){var o=a.APP_HOST,n=-1===e.indexOf("://")||0===e.indexOf(o);return n?(0===e.indexOf(o)&&(e=e.replace(o,"")),e=e.replace(/^(\/|#)+/,""),f.router.navigate(e,{trigger:void 0===r?!0:r,replace:void 0===t?!1:t})):void(window.location.href=e)}};return f});
define("base/Widget",["require","exports","module","base/declare","./_WidgetBase","./_TemplatedMixin","./_WidgetsInTemplateMixin"],function(require,exports,module){var e=require("base/declare"),t=require("./_WidgetBase"),i=require("./_TemplatedMixin"),a=require("./_WidgetsInTemplateMixin");return e("base.Widget",[t,i,a],{_templateString:'<div class="<%=baseClass%>" id="<%=id%>">${X}</div>',templateString:"",widgetsInTemplate:!0,postMixInProperties:function(){this.templateString=this._templateString.replace("${X}",this.templateString),this.inherited(arguments)}})});
define("base/text!app/views/Header.html",[],"<div class=\"row header-inner\"><h3 class=\"logo-wrapper\"><img src=\"<%- blankGif %>\" class=\"site-logo img-cover\" style=\"background-image: url('<%- logoUrl %>')\" ks-event=\"click: onClickLogo\"></h3><div class=\"header-location\">: <span class=\"site-loc\" ks-node=\"locationNode\"></span></div></div>");
define("base/io-query",["require","exports","module","./lang"],function(require,exports,module){var e=require("./lang"),i={};return{location:function(e){var i,r,n;return e=e||location.href,i=e.match(/^[^?#]+/i)[0],e=e.slice(i.length),e.match(/^\?[^#]+/i)?(n=e.match(/^\?[^#]+/i)[0],e=e.slice(n.length),e.match(/^#[^?]+/i)&&(r=e.match(/^#[^?]+/i)[0])):e.match(/^#[^?]+/i)&&(r=e.match(/^#[^?]+/i)[0],e=e.slice(r.length),e.match(/^\?[^#]+/i)&&(n=e.match(/^\?[^#]+/i)[0])),e={domain:i,query:(n||"").slice(1),hash:(r||"").slice(1),param:{},toString:function(){var e,i,t;n="",i=this.param;for(e in i)t=i[e],n+=e,void 0!==t&&null!==t&&(n+="="+t);return n&&(n="?"+n),r=this.hash?"#"+this.hash:"",this.domain+n+r}},e.query&&e.query.replace(/(?:^|&)([^=&]+)(?:=([^&]*))?/gi,function(i,r,n){return e.param[r]=n}),e},objectToQuery:function(r){var n=encodeURIComponent,t=[];for(var a in r){var o=r[a];if(o!=i[a]){var c=n(a)+"=";if(e.isArray(o))for(var h=0,u=o.length;u>h;++h)t.push(c+n(o[h]));else t.push(c+n(o))}}return t.join("&")},queryToObject:function(i){for(var r,n,t,a=decodeURIComponent,o=i.split("&"),c={},h=0,u=o.length;u>h;++h)if(t=o[h],t.length){var s=t.indexOf("=");0>s?(r=a(t),n=""):(r=a(t.slice(0,s)),n=a(t.slice(s+1))),"string"==typeof c[r]&&(c[r]=[c[r]]),e.isArray(c[r])?c[r].push(n):c[r]=n}return c},fromToObject:function(e){}}});
define("base/text!app/views/Page.html",[],"<div class=\"<%=baseClass%>\" id=\"<%=id%>\"><div ks-type=\"app/Header\" ks-props=\"location:location\" ks-node=\"header\"></div><div class=\"row app-content\">\n\t\t${X}\n\t</div><div class=\"row app-footer\"><%if (downloadUrl) {%><a href=\"<%-downloadUrl%>\"><span class=\"inline\">SPAN.IM</span></a><%}%></div></div>");
define("app/Header",["require","exports","module","base/declare","base/dom","base/Widget","./routes","base/url!../images/logo.png","base/url!../images/sprite.png","base/text!./views/Header.html"],function(require,exports,module){var e=require("base/declare"),a=require("base/dom"),t=require("base/Widget"),o=require("./routes"),s=require("base/url!../images/logo.png"),r=require("base/url!../images/sprite.png"),i=require("base/text!./views/Header.html");return e("app.Header",t,{baseClass:"app-header",templateString:i,logoUrl:s,loveIconUrl:r,location:"/",_locationSetter:function(e){a.html(this.locationNode,e)},onClickLogo:function(){o.navigate("/",!0)}})});
define("app/Page",["require","exports","module","base/declare","base/sniff","base/topic","base/io-query","base/dom","base/Widget","./app.config","./routes","base/text!./views/Page.html","./Header"],function(require,exports,module){var e=require("base/declare"),t=require("base/sniff"),i=require("base/topic"),s=require("base/io-query"),a=require("base/dom"),o=require("base/Widget"),p=(require("./app.config"),require("./routes"),require("base/text!./views/Page.html"));return require("./Header"),e("app.Page",o,{widgetsInTemplate:!0,baseClass:"page-entry",_templateString:p,templateString:"",location:"/",downloadUrl:!1,seoTitle:"SPAN.IM",pageTitle:"",pageKeywords:"default page keywords",pageDescription:"default page description",_initPageSEO:function(){document.title=(this.pageTitle||"")+(this.pageTitle?"-":"")+this.seoTitle,a.query("meta[name=keywords]").attr("content",this.pageKeywords),a.query("meta[name=description]").attr("content",this.pageDescription)},isIOS:t("ios"),isAndroid:t("android"),postMixInProperties:function(){this.query=s.location().param,this.pageClass="ks-"+this.baseClass,this.inherited(arguments),this._initPageSEO(),i.publish("/app/page/init",this)},postCreate:function(){a.addClass(this.ownerDocumentBody,this.pageClass),this.inherited(arguments),i.publish("/app/page/create",this)},startup:function(){a.addClass(this.domNode,"active"),this.inherited(arguments),this.ownerDocumentBody.offsetWidth,i.publish("/app/page/startup",this)},destroy:function(){a.removeClass(this.ownerDocumentBody,this.pageClass),this.inherited(arguments),i.publish("/app/page/destroy",this)}})});
define("base/url",["require","exports","module"],function(require,exports,module){exports.load=function(e,r,n){return n(r.toUrl(e))}});
define("base/text",["require","exports","module","jquery"],function(require,exports,module){var e=require("jquery").ajax;exports.load=function(t,r,u){return e({url:r.toUrl(t),type:"GET",dataType:"text"}).then(u)}});